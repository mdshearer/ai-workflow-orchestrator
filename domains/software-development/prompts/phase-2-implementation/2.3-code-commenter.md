# Prompt: Code Commenter (Add Meaningful Comments)

**Persona:** Specialist Developer (Code Documentation)
**Phase:** 2 - Implementation
**Purpose:** Add high-quality comments to existing code

---

## When to Use This Prompt

✅ **Use when:**
- You have implemented code without comments
- You inherited uncommented code
- You want to improve code maintainability before a release
- You want a "documentation pass" on completed features

❌ **Don't use when:**
- You're writing new code (add comments as you write)
- The code is temporary/throwaway
- You want to write code (use 2.2-iterative-implementation)

---

## The Philosophy: Good Comments Explain "Why", Not "What"

**Bad comments** (redundant, noise):
```python
# Loop through users
for user in users:
    # Print user name
    print(user.name)
```

**Good comments** (explain intent, business logic):
```python
# Send welcome emails only to users who registered in the last 24 hours
# to avoid spamming users who signed up earlier
for user in recent_users:
    send_welcome_email(user)
```

---

## The Prompt Template

```markdown
You are a "Code Commenter" AI Agent. Your goal is to add meaningful, high-quality comments to the attached codebase to improve readability and maintainability.

**Codebase:**
[Paste or attach your uncommented code]

**Rules:**

1. **You must adhere to the commenting standards in `CONSTITUTION.md`**

2. **Analyze Code Structure:**
   - Parse all functions, classes, methods, and complex logic
   - Identify the purpose of each component

3. **Generate Clear Comments:**

   **Function/Class Headers:**
   - Add documentation headers (JSDoc for JS/TS, docstrings for Python, GoDoc for Go)
   - Explain the **purpose** of the function/class
   - Document **parameters** (what they are, what they mean)
   - Document **return values** (what is returned)
   - Document **exceptions/errors** that might be thrown
   - Include usage examples for complex functions (optional)

   **Inline Comments:**
   - Add comments for complex logic (algorithms, business rules)
   - Explain the **intent** or the **"why"** behind the code
   - **CRITICAL: Do NOT add redundant comments** that just restate the syntax
     - ❌ BAD: `// loop for i...` on a `for` loop
     - ❌ BAD: `// set x to 5` on `x = 5`
     - ✅ GOOD: `// Retry up to 3 times to handle transient network failures`

4. **Maintain Readability:**
   - Keep comments concise (1-2 sentences usually)
   - Follow existing indentation and formatting
   - Use proper grammar and spelling

5. **Comment Types to Add:**
   - **TODO comments** for known issues or future improvements: `// TODO: Add input validation`
   - **FIXME comments** for bugs: `// FIXME: This breaks with negative numbers`
   - **NOTE comments** for important explanations: `// NOTE: This must run before database connection`
   - **HACK comments** for temporary workarounds: `// HACK: Workaround for bug in library v1.2.3`

**What NOT to Comment:**
- Simple variable assignments (unless the value is non-obvious)
- Standard language constructs (loops, conditionals) unless the logic is complex
- Self-explanatory code with good variable names

**Output:**
- Return the fully commented version of the code
- Preserve all original code structure and indentation
- Add only comments (no code changes)

---

**Files to Attach:**
- Your uncommented code
- `CONSTITUTION.md` (for commenting standards)
```

---

## How to Use This Prompt

### Step 1: Identify Code to Comment

Choose:
- [ ] Newly implemented code without comments
- [ ] Legacy code that's hard to understand
- [ ] Complex algorithms or business logic
- [ ] Public APIs or libraries

### Step 2: Prepare the Code

- [ ] Attach the code file(s)
- [ ] Attach `CONSTITUTION.md`

### Step 3: Invoke the AI

Paste the prompt with code attached.

### Step 4: Review the Comments

Check for:
- [ ] Comments explain "why", not "what"
- [ ] Function headers are complete (params, returns, purpose)
- [ ] Complex logic is explained
- [ ] No redundant comments
- [ ] Comments follow style guide (CONSTITUTION.md)

### Step 5: Apply the Comments

- [ ] Copy commented code back to your project
- [ ] Verify indentation is preserved
- [ ] Run linters/formatters
- [ ] Commit the changes

---

## Example Input

```markdown
**Codebase:**

```python
def process_payment(user_id, amount, currency):
    user = db.query(User).filter(User.id == user_id).first()
    if not user:
        raise UserNotFoundError()

    if amount <= 0:
        raise InvalidAmountError()

    if currency not in ['USD', 'EUR', 'GBP']:
        raise UnsupportedCurrencyError()

    if user.balance < amount:
        raise InsufficientFundsError()

    user.balance -= amount
    db.commit()

    transaction = Transaction(
        user_id=user_id,
        amount=amount,
        currency=currency,
        type='debit',
        timestamp=datetime.now()
    )
    db.add(transaction)
    db.commit()

    send_notification(user.email, 'payment_processed', {
        'amount': amount,
        'currency': currency
    })

    return transaction.id
```

**Constitution:** (attached)
```

---

## Example Output (What the Code Commenter Should Generate)

```python
def process_payment(user_id: str, amount: float, currency: str) -> str:
    """
    Process a payment by debiting the user's account balance.

    This function handles the complete payment flow including validation,
    balance deduction, transaction recording, and user notification.

    Args:
        user_id (str): UUID of the user making the payment
        amount (float): Payment amount (must be positive)
        currency (str): ISO 4217 currency code (USD, EUR, or GBP)

    Returns:
        str: Transaction ID for the created transaction record

    Raises:
        UserNotFoundError: If user_id doesn't exist in database
        InvalidAmountError: If amount is zero or negative
        UnsupportedCurrencyError: If currency is not supported
        InsufficientFundsError: If user's balance is less than amount

    Example:
        >>> transaction_id = process_payment('user-123', 50.00, 'USD')
        >>> print(transaction_id)
        'txn-abc123'

    Note:
        This function commits to the database twice (balance update and
        transaction record). Consider wrapping in a single transaction
        for atomicity.
    """
    # Validate user exists in database
    user = db.query(User).filter(User.id == user_id).first()
    if not user:
        raise UserNotFoundError()

    # Validate amount is positive (zero is not allowed)
    if amount <= 0:
        raise InvalidAmountError()

    # Validate currency is supported (expand list in config if needed)
    # Currently supports: USD (US Dollar), EUR (Euro), GBP (British Pound)
    if currency not in ['USD', 'EUR', 'GBP']:
        raise UnsupportedCurrencyError()

    # Check sufficient funds before processing
    # This prevents overdraft and maintains account integrity
    if user.balance < amount:
        raise InsufficientFundsError()

    # Deduct amount from user's balance
    # NOTE: This updates the user record but doesn't create an audit trail yet
    user.balance -= amount
    db.commit()

    # Create transaction record for audit trail
    # Type is 'debit' because we're removing money from user's account
    transaction = Transaction(
        user_id=user_id,
        amount=amount,
        currency=currency,
        type='debit',
        timestamp=datetime.now()
    )
    db.add(transaction)
    db.commit()

    # Notify user via email that payment was processed
    # This is fire-and-forget (doesn't block on email delivery)
    send_notification(user.email, 'payment_processed', {
        'amount': amount,
        'currency': currency
    })

    # Return transaction ID for client to track/reference
    return transaction.id
```

---

## Comment Types and When to Use Them

### 1. Function/Method Documentation (Always)

**JavaScript/TypeScript (JSDoc):**
```typescript
/**
 * Calculate the total price including tax
 *
 * @param subtotal - Price before tax
 * @param taxRate - Tax rate as decimal (e.g., 0.08 for 8%)
 * @returns Total price with tax applied
 * @throws {Error} If subtotal is negative or taxRate is invalid
 */
function calculateTotal(subtotal: number, taxRate: number): number {
    // ...
}
```

**Python (Google-style docstring):**
```python
def calculate_total(subtotal: float, tax_rate: float) -> float:
    """
    Calculate the total price including tax.

    Args:
        subtotal: Price before tax
        tax_rate: Tax rate as decimal (e.g., 0.08 for 8%)

    Returns:
        Total price with tax applied

    Raises:
        ValueError: If subtotal is negative or tax_rate is invalid
    """
    # ...
```

### 2. Inline Comments for Complex Logic

```python
# Binary search requires sorted array - sort first if not guaranteed
# Time complexity: O(n log n) for sort + O(log n) for search
items.sort(key=lambda x: x.id)
result = binary_search(items, target_id)
```

### 3. Business Logic Comments

```python
# Company policy: Refunds are only allowed within 30 days of purchase
# and only for items not marked as 'final sale'
if days_since_purchase <= 30 and not item.is_final_sale:
    process_refund(item)
```

### 4. Security/Privacy Comments

```python
# Security: Always hash passwords before storage (never store plain text)
# Using bcrypt with cost factor 12 (recommended as of 2025)
hashed_password = bcrypt.hashpw(password.encode(), bcrypt.gensalt(12))
```

### 5. Performance Comments

```python
# Performance: Using bulk insert instead of individual inserts
# Reduces database round-trips from N to 1
db.bulk_insert(users)
```

### 6. TODO/FIXME/HACK Comments

```python
# TODO: Add retry logic for transient network failures (ticket: PROJ-123)
response = api.call(endpoint)

# FIXME: This breaks when email contains special characters
# Bug tracked in PROJ-456
user_name = email.split('@')[0]

# HACK: Library v1.2 has bug with dates, this workaround can be removed
# after upgrading to v1.3+ (see issue #789 in library repo)
date_string = date.isoformat() + 'Z'
```

---

## Tips for Better Comments

### ✅ DO:
- Explain the "why" (intent, business logic)
- Explain non-obvious code
- Document all public APIs
- Keep comments up-to-date when code changes
- Use proper grammar and spelling
- Add examples for complex functions

### ❌ DON'T:
- State the obvious: `// Set x to 5` for `x = 5`
- Comment every line
- Write comments that contradict the code
- Leave outdated comments when code changes
- Use comments to disable code (delete it instead)
- Write novels (be concise)

---

## After Commenting Checklist

- [ ] All public functions have documentation headers
- [ ] Complex logic is explained
- [ ] No redundant comments
- [ ] Comments use proper grammar
- [ ] Comments follow CONSTITUTION.md style
- [ ] TODOs/FIXMEs include ticket numbers (if applicable)
- [ ] Comments are up-to-date with the code

---

## When to Skip Commenting

Some code is self-documenting and doesn't need comments:

```python
# ❌ Don't comment obvious code
# Calculate total
total = subtotal + tax

# ✅ Self-explanatory with good variable names (no comment needed)
total = subtotal + tax
```

```python
# ❌ Don't comment trivial logic
# Check if user is admin
if user.role == 'admin':
    # ...

# ✅ Self-explanatory (no comment needed)
if user.is_admin():
    # ...
```

---

## Related Resources

- [Specialist Developer Persona](../../personas/03-specialist-developer.md)
- [Google Python Style Guide - Comments](https://google.github.io/styleguide/pyguide.html#38-comments-and-docstrings)
- [JSDoc Reference](https://jsdoc.app/)
- Previous: [Iterative Implementation](./2.2-iterative-implementation.md)
- Next: [QA Comprehensive Review](../phase-3-review/3.1-qa-comprehensive-review.md)
