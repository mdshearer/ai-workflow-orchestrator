# Prompt: QA Testability Assessment

**Persona:** QA Engineer (Test Architect)
**Phase:** 3 - Review and Refactoring
**Purpose:** Assess how easy code is to test

---

## When to Use This Prompt

✅ **Use when:**
- You want to improve unit test coverage
- Code is hard to test
- You want refactoring suggestions for testability

❌ **Don't use when:**
- Code is already highly testable
- You don't care about unit tests

---

## The Prompt Template

```markdown
You are a Test Architect. Analyze this code for testability issues.

**Code to Analyze:**
[Paste your code]

**Your Task:**
Identify testability issues and suggest refactorings. Focus on:

1. **Separation of Concerns:**
   - Does the function do too much?
   - Can it be split into smaller, testable units?

2. **Hard-Coded Dependencies:**
   - Are there hardcoded database calls?
   - Are there hardcoded file system operations?
   - Are there hardcoded API calls?
   - Can dependencies be injected?

3. **Global State:**
   - Does the code rely on global variables?
   - Does it modify global state?

4. **Pure Functions:**
   - Does the function have side effects?
   - Can it be made pure (same input → same output)?

5. **Mocking Difficulties:**
   - What would be hard to mock in tests?
   - Can it be refactored to make mocking easier?

**Output Format:**
For each issue:
- **Testability Issue:** [Description]
- **Current Code:** [The problematic code]
- **Why It's Hard to Test:** [Explanation]
- **Refactoring Suggestion:** [Code example]

---

**Files to Attach:**
- Code to analyze
```

---

## Common Testability Issues

### 1. Hard-Coded Dependencies
```python
# ❌ Hard to test: Database hardcoded
def get_user(user_id):
    db = DatabaseConnection()  # Hardcoded!
    return db.query(f"SELECT * FROM users WHERE id = {user_id}")

# ✅ Testable: Dependency injection
def get_user(user_id, db):
    return db.query("SELECT * FROM users WHERE id = ?", (user_id,))
```

### 2. Mixed Concerns
```python
# ❌ Hard to test: Validation + DB + Email in one function
def create_user(email, password):
    if not '@' in email:
        raise ValueError()
    db.insert(email, password)
    send_welcome_email(email)

# ✅ Testable: Separated concerns
def validate_email(email):
    if not '@' in email:
        raise ValueError()

def create_user(email, password, db, email_service):
    validate_email(email)
    user = db.insert(email, password)
    email_service.send_welcome_email(user)
```

### 3. Global State
```python
# ❌ Hard to test: Uses global state
total = 0
def add_to_total(value):
    global total
    total += value

# ✅ Testable: Pure function
def add_to_total(current_total, value):
    return current_total + value
```

---

## Related Resources

- [QA Engineer Persona](../../personas/04-qa-engineer.md)
- Next: [Architect Refactor Consultation](./3.6-architect-refactor-consultation.md)
