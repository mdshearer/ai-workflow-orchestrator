# Prompt: QA Security Audit

**Persona:** QA Engineer (Security Auditor)
**Phase:** 3 - Review and Refactoring
**Purpose:** Security-focused code review

---

## When to Use This Prompt

✅ **Use when:**
- Code handles user input
- Code deals with authentication/authorization
- Code handles sensitive data (PII, passwords, payment info)
- Before deploying to production

❌ **Don't use when:**
- Code has no security implications
- You want general code review

---

## The Prompt Template

```markdown
You are a Security Auditor. Review this code for security vulnerabilities.

**Code to Audit:**
[Paste your code]

**Rules:**
1. Check for violations against security rules in `CONSTITUTION.md`
2. Reference OWASP Top 10 when applicable
3. Categorize findings by risk level: CRITICAL, HIGH, MEDIUM, LOW

**Security Checklist:**

**OWASP Top 10 (2021):**
- [ ] A01: Broken Access Control
- [ ] A02: Cryptographic Failures
- [ ] A03: Injection (SQL, NoSQL, Command, LDAP)
- [ ] A04: Insecure Design
- [ ] A05: Security Misconfiguration
- [ ] A06: Vulnerable and Outdated Components
- [ ] A07: Identification and Authentication Failures
- [ ] A08: Software and Data Integrity Failures
- [ ] A09: Security Logging and Monitoring Failures
- [ ] A10: Server-Side Request Forgery (SSRF)

**Common Vulnerabilities:**
- [ ] SQL injection
- [ ] XSS (Cross-Site Scripting)
- [ ] CSRF (Cross-Site Request Forgery)
- [ ] Path traversal
- [ ] Insecure direct object references
- [ ] Missing authentication/authorization
- [ ] Weak password hashing
- [ ] Hardcoded secrets
- [ ] Sensitive data in logs
- [ ] Missing input validation
- [ ] Missing rate limiting
- [ ] Insecure HTTP headers

**Output Format:**
For each vulnerability:
- **Vulnerability:** [Name]
- **OWASP Category:** [If applicable]
- **Risk Level:** CRITICAL/HIGH/MEDIUM/LOW
- **Location:** File:Line
- **Exploit Scenario:** [How attacker could exploit]
- **Remediation:** [How to fix, with code]

---

**Files to Attach:**
- Code to audit
- CONSTITUTION.md
```

---

## Common Security Issues

### 1. SQL Injection
```python
# ❌ CRITICAL: SQL Injection
query = f"SELECT * FROM users WHERE id = {user_id}"

# ✅ FIX: Use parameterized queries
query = "SELECT * FROM users WHERE id = ?"
cursor.execute(query, (user_id,))
```

### 2. XSS (Cross-Site Scripting)
```javascript
// ❌ HIGH: XSS vulnerability
element.innerHTML = userInput;

// ✅ FIX: Use textContent or sanitize
element.textContent = userInput;
```

### 3. Weak Password Hashing
```python
# ❌ CRITICAL: MD5 is cryptographically broken
import hashlib
password_hash = hashlib.md5(password.encode()).hexdigest()

# ✅ FIX: Use bcrypt
import bcrypt
password_hash = bcrypt.hashpw(password.encode(), bcrypt.gensalt())
```

### 4. Hardcoded Secrets
```python
# ❌ CRITICAL: Hardcoded API key
API_KEY = "sk_live_abc123xyz789"

# ✅ FIX: Use environment variables
import os
API_KEY = os.getenv("API_KEY")
```

### 5. Missing Authorization
```python
# ❌ HIGH: No permission check
def delete_user(user_id):
    db.delete(user_id)

# ✅ FIX: Check permissions
def delete_user(user_id, current_user):
    if not current_user.is_admin():
        raise Forbidden("Only admins can delete users")
    db.delete(user_id)
```

---

## Risk Levels

- **CRITICAL:** Leads to complete system compromise, data breach
- **HIGH:** Allows unauthorized access, data manipulation
- **MEDIUM:** Limited exploit potential, requires specific conditions
- **LOW:** Theoretical risk, hard to exploit

---

## Related Resources

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [QA Engineer Persona](../../personas/04-qa-engineer.md)
- Next: [Style & Standards](./3.4-qa-style-standards.md)
